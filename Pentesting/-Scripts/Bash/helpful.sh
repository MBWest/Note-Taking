#!/bin/bash

#Main menu function - it has read, case and a while loop
main_menu () { while true
do
clear
echo -e "\n--Main Menu--"
echo "0: Basic Information"
echo "1: Update Menu"
echo "2: Domain Recon Menu"
echo "3: Tool Menu"
echo "E: Exit"
echo "---------------"
read -p "Please enter your choice: " main_menu_choice
case $main_menu_choice in 
    0) basic_information_menu;;
    1) update_menu;;
    2) domain_recon_menu;;
    3) tool_menu;;
    e|E) exit;;
#
esac
done
}

#####-----BASIC INFORMATION MENU-----#####

##Basic Information Menu
basic_information_menu () { while true
do
echo -e "\n--Basic Information Menu--"
echo "0: Machine Information"
echo "E: Exit"
echo "M: Go Back to the Main Menu"
echo "---------------"
read -p "Please enter your choice: " basic_information_choice
case $basic_information_choice in 
    0) machine_information;;
    e|E) exit;;
    m|M) main_menu;;
#
esac
done
}

#####-----Basic Information Functions-----#####

##Machine Information
machine_information() {
    clear
    echo -e "\n-----Basic Machine Information-----"
    echo "IP Address: " $(hostname -I | cut -d' ' -f1)
    echo "Hostname: " $(hostname)
    echo "Who am I: " $(whoami)
    echo "id: " $(id)
    echo "uname: " $(uname)
}

#####-----UPDATE MENU-----#####
update_menu () { while true
do
clear
echo -e "\n--Update Menu--"
echo "0: Ubuntu VirtualBox Maintenance"
echo "1: Ubuntu/Debian"
echo "2: Fedora"
echo "3: openSuSe"
echo "4: Manjaro/Arch"
echo "E: Exit"
echo "M: Go Back to the Main Menu"
echo "---------------"
read -p "Please enter your choice: " update_menu_choice
case $update_menu_choice in
    0) ubuntu_virtualbox_maintenance;;
    1) ubuntu_debian_update;;
    2) fedora_update;;
    3) opensuse_update;;
    4) manjaro_arch_update;;
    e|E) exit;;
    m|M) main_menu;;
#
esac
done
}

##VirtualBox Maintenance
ubuntu_virtualbox_maintenance() {
    echo "[+] Accomplishing VirtualBox maintenance..."
    sudo apt update
    sudo apt install -y build-essential dkms gcc make perl
    sudo rcvboxadd setup
    echo "[+] System requires reboot"
}

#####-----UPDATE FUNCTIONS-----#####

##Update function for Ubuntu/Debian
ubuntu_debian_update() {
    echo "[+] Ubuntu is updating..."
    sudo apt update -y && sudo apt upgrade -y
    echo "[+] Cleaning up..."
    sudo apt clean -y
    sudo apt autoclean -y
    sudo apt autoremove -y 
}

##Update function for Fedora
fedora_update() {
    echo "[+] Fedora is updating..."
    sudo dnf upgrade -y
}

##Update function for OpenSuSe
opensuse_update() {
    echo "[+] OpenSuSe is updating..."
    sudo zypper refresh -y && sudo zypper update -y
}

##Update function for Manjaro/Arch
manjaro_arch_update() {
    echo "[+] Manjaro/Arch is updating..."
    sudo pacman -Syyu
}

#####-----RECON MENU-----#####
domain_recon_menu () { while true
do
read -p "What domain would you like to recon? " domain_url
url=$domain_url # URL variable for domain recon
regex='^[-A-Za-z0-9\+&@#/%?=~_|!:,.;]*[-A-Za-z0-9\+&@#/%=~_|]\.[-A-Za-z0-9\+&@#/%?=~_|!:,.;]*[-A-Za-z0-9\+&@#/%=~_|]$'
if [[ $url =~ $regex ]]
then 
    echo "$url IS valid"
else
    echo "$url IS NOT valid"
    domain_recon_menu
fi
echo -e "\n--Recon Menu--"
echo "1: Harvest Subdomains with Assestfinder"
echo "2: Havest Subdomains with Amass"
echo "3: Check if Recon'd Domains are Alive with httprobe"
echo "E: Exit"
echo "M: Go Back to the Main Menu"
echo "---------------"
read -p "Please enter your choice: " domain_recon_menu_choice
case $domain_recon_menu_choice in
    1) assestfinder_recon;;
    2) amass_recon;;
    3) httprobe_recon;;
    e|E) exit;;
    m|M) main_menu;;
#
esac
done
}

#####-----RECON FUNCTIONS-----#####

#Harvesting subdomains with assetfinder
assestfinder_recon() {
    if [ ! -d "$domain_recon_url" ];then
    mkdir $domain_recon_url
    fi
    if [ ! -d "$domain_recon_url/recon" ];then
    mkdir $domain_recon_url/recon
    fi
    echo "[+] Harvesting subdomains with assetfinder..."
    assetfinder $domain_recon_url >> $domain_recon_url/recon/assests.txt
    cat $domain_recon_url/recon/assests.txt | grep $1 >> $domain_recon_url/recon/final.txt
    rm $domain_recon_url/recon/assests.txt
}

#Harvesting subdomains with amass
amass_recon() {
    if [ ! -d "$domain_recon_url" ];then
    mkdir $domain_recon_url
    fi
    if [ ! -d "$domain_recon_url/recon" ];then
    mkdir $domain_recon_url/recon
    fi
    echo echo "[+] Harvesting subdomains with amass..."
    amass enum -d $domain_recon_url >> $domain_recon_url/recon/f.txt
    sort -u $domain_recon_url/recon/f.txt >> $domain_recon_url/recon/final.txt
    rm $domain_recon_url/recon/f.txt
}

#Check if recon items are alive
httprobe_recon() {
    if [ ! -d "$domain_recon_url" ];then
    mkdir $domain_recon_url
    fi
    if [ ! -d "$domain_recon_url/recon" ];then
    mkdir $domain_recon_url/recon
    fi
    echo "[+] Probing for alive domains..."
    cat $domain_recon_url/recon/final.txt | sort -u | httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443' 
>> $domain_recon_url/recon/alive.txt
}

#####-----TOOL MENU-----#####
tool_menu () { while true
do
echo -e "\n--Tool Menu--"
echo "0: Install Tools"
echo "1: Install Firefox Profile"
echo "2: User Interface Configuration"
echo "3: Update Software"
echo "4: Caller ID Script"
echo "5: Run Options 0-4"
echo "E: Exit"
echo "M: Go Back to the Main Menu"
echo "---------------"
read -p "Please enter your choice: " tool_choice
case $tool_choice in
    0) install_tools;;
    1) install_firefox_profile;;
    2) user_interface_configuration;;
    3) software_updates;;
    4) caller_id;;
    5) install_tools && install_firefox_profile && user_interface_configuration && software_updates && caller_id;;
    e|E) exit;;
    m|M) main_menu;;
#
esac
done
}

#Tools Installation
install_tools() {
    echo "[+] Starting the OSINT tool installation..."
    echo "[+] Updating tools..."
    sudo apt-get -y update
    echo "[+] Upgrading tools..."
    sudo apt-get -y upgrade
    echo "[+] Creating a ~/tools directory..."
    mkdir ~/tools
    echo "[+] Moving to the ~/tools directory..."
    cd ~/tools/
    echo "[+] Installing tools..."
    sudo snap install vlc
    sudo apt install -y ffmpeg
    sudo apt install -y python3-pip
    sudo -H pip install youtube-dl
    sudo -H pip install yt-dlp
    sudo -H pip install youtube-tool
    cd ~/tools/
    sudo apt install -y curl
    curl -u osint9:book143wt -O https://inteltechniques.com/osintbook9/vm-files.zip
    unzip vm-files.zip -d ~/tools/
    mkdir ~/tools/scripts
    mkdir ~/tools/icons
    cd ~/tools/vm-files/scripts
    cp * ~/tools/scripts
    cd ~/tools/vm-files/icons
    cp * ~/tools/icons
    cd ~/tools/vm-files/shortcuts
    sudo cp * /usr/share/applications/
    cd ~/tools
    rm vm-files.zip
    rm -rf vm-files
    sudo -H pip install streamlink
    sudo -H pip install Instalooter
    sudo -H pip install Instaloader
    sudo -H pip install toutatis
    cd ~/tools
    sudo apt install -y git
    git clone https://github.com/Datalux/Osintgram.git
    cd Osintgram
    sudo apt-get install libncurses5-dev libffi-dev -y
    sudo -H pip install -r requirements.txt -I
    #make setup (This asks for IG username/pass, skip if desired)
    sudo snap install gallery-dl
    sudo snap connect gallery-dl:removable-media
    cd ~/tools
    sudo apt install default-jre -y
    wget https://github.com/ripmeapp/ripme/releases/latest/download/ripme.jar
    chmod +x ripme.jar
    cd ~/tools/
    git clone https://github.com/sherlock-project/sherlock.git
    cd sherlock
    sudo -H pip install -r requirements.txt -I
    sudo -H pip install socialscan -I
    sudo -H pip install holehe -I
    cd ~/Downloads/Programs
    git clone https://github.com/WebBreacher/WhatsMyName.git
    cd WhatsMyName
    sudo -H pip install -r requirements.txt -I
    cd ~/tools/
    git clone https://github.com/martinvigo/email2phonenumber.git
    cd email2phonenumber
    sudo -H pip install -r requirements.txt -I
    cd ~/tools/
    git clone https://github.com/ChrisTruncer/EyeWitness.git
    cd EyeWitness/Python/setup
    sudo -H ./setup.sh
    sudo snap install amass
    cd ~/tools/
    git clone https://github.com/aboul3la/Sublist3r.git
    cd Sublist3r
    sudo -H pip install -r requirements.txt -I
    cd ~/tools/
    git clone https://github.com/s0md3v/Photon.git
    cd Photon
    sudo -H pip install -r requirements.txt -I
    cd ~/tools/
    git clone https://github.com/laramies/theHarvester.git
    cd theHarvester
    sudo -H pip install -r requirements.txt -I
    sudo -H pip install testresources -I
    sudo -H pip install pipenv -I
    sudo -H pip install webscreenshot -I
    cd ~/tools/
    git clone https://github.com/Lazza/Carbon14
    cd Carbon14
    sudo -H pip install -r requirements.txt -I
    sudo apt install tor torbrowser-launcher -y
    cd ~/tools/
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo apt install -y ./google-chrome-stable_current_amd64.deb
    sudo rm google-chrome-stable_current_amd64.deb
    sudo apt install -y mediainfo-gui
    sudo apt install -y libimage-exiftool-perl
    sudo apt install -y mat2
    sudo -H pip install xeuledoc -I
    cd ~/tools/
    sudo apt install subversion -y
    git clone https://github.com/GuidoBartoli/sherloq.git
    cd sherloq/gui
    sudo -H pip install -r requirements.txt -I
    sudo -H pip install matplotlib
    sudo apt install -y webhttrack
    sudo apt install -y libcanberra-gtk-module
    cd ~/tools/
    git clone https://github.com/opsdisk/metagoofil.git
    cd metagoofil
    sudo -H pip install -r requirements.txt -I
    sudo apt install software-properties-common -y
    sudo add-apt-repository ppa:deadsnakes/ppa -y
    sudo apt update
    sudo apt install python3.9 -y
    sudo -H python3.9 -m pip install bdfr -I
    sudo -H pip install redditsfinder -I
    cd ~/tools/
    git clone https://github.com/MalloyDelacroix/DownloaderForReddit.git
    cd DownloaderForReddit
    sudo -H pip install -r requirements.txt -I
    sudo apt install -y kazam
    sudo snap install keepassxc
    sudo apt update --fix-missing
    sudo apt -y upgrade
    sudo apt --fix-broken install
    sudo -H pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 sudo -H pip install -U
    go get github.com/michenriksen/aquatone
    cd ~/tools/
    git clone https://github.com/nahamsec/JSParser.git
    cd JSParser*
    sudo python setup.py install
    cd ~/tools/
    git clone https://github.com/aboul3la/Sublist3r.git
    cd Sublist3r*
    pip install -r requirements.txt
    cd ~/tools/
    git clone https://github.com/tomdev/teh_s3_bucketeers.git
    cd ~/tools/
    git clone https://github.com/wpscanteam/wpscan.git
    cd wpscan*
    sudo gem install bundler && bundle install --without test
    cd ~/tools/
    git clone https://github.com/maurosoria/dirsearch.git
    cd ~/tools/
    git clone https://github.com/nahamsec/lazys3.git
    cd ~/tools/
    git clone https://github.com/jobertabma/virtual-host-discovery.git
    cd ~/tools/
    git clone https://github.com/guelfoweb/knock.git
    cd ~/tools/
    git clone https://github.com/nahamsec/lazyrecon.git
    cd ~/tools/
    git clone https://github.com/blechschmidt/massdns.git
    cd ~/tools/massdns
    cd ~/tools/
    git clone https://github.com/yassineaboukir/asnlookup.git
    cd ~/tools/asnlookup
    pip install -r requirements.txt
    cd ~/tools/
    go get -u github.com/tomnomnom/assetfinder
    cd ~/tools/
    go get -u github.com/tomnomnom/httprobe
    echo "[+] Installing Search Tools..."
    curl -u osint9:book143wt -O https://inteltechniques.com/osintbook9/tools.zip
    unzip tools.zip -d ~/tools
    rm tools.zip
    cd ~/Downloads/Programs
    echo "[+] Installing Advanced OSINT Tools..."
    git clone https://github.com/lanmaster53/recon-ng.git
    cd recon-ng
    sudo -H pip install -r REQUIREMENTS -I
    cd ~/tools
    git clone https://github.com/smicallef/spiderfoot.git
    cd spiderfoot
    sudo -H pip install -r requirements.txt -I
    cd ~/tools
    git clone https://github.com/AmIJesse/Elasticsearch-Crawler.git
    sudo -H pip install nested-lookup -I
    sudo -H pip install internetarchive -I
    sudo apt install -y ripgrep
    sudo -H pip install waybackpy -I
    sudo -H pip install search-that-hash -I
    sudo -H pip install h8mail -I
    cd ~/tools
    h8mail -g
    sed -i 's/\;leak\-lookup\_pub/leak\-lookup\_pub/g' h8mail_config.ini
    cd ~/tools
    git clone https://github.com/mxrch/ghunt
    cd ghunt
    sudo -H pip install -r requirements.txt -I
    #Finished installing tools
    cd ~/tools/
    echo -e "\n\n\n\n\n\n\n\n\n\n\n[+] Done! All tools are set up in ~/tools"
    echo -e "\n\n\n\n\n\n\n\n\n\n\n[+] Please Restart ASAP!"
    ls -la
}

#Install Firefox OSINT Profile
install_firefox_profile() {
    echo "[+] Opening Firefox..."
    firefox&
    sleep 5
    echo "[+] Closing Firefox..."
    pkill -f firefox
    cd ~/Desktop
    curl -u osint9:book143wt -O https://inteltechniques.com/osintbook9/ff-template.zip
    unzip ff-template.zip -d ~/snap/firefox/
    cd ~/snap/firefox/ff-template/
    cp -R * ~/snap/firefox/common/.mozilla/firefox/*.default
    cd ~/Desktop
    rm ff-template.zip
    echo "[+] Open Firefox and update all add-ons...]"
    sleep 5
}

#Changing User Interface Configuration
user_interface_configuration() {
    echo "[+] Changing User Interface Configuration..."
    gsettings set org.gnome.desktop.background picture-uri ''
    gsettings set org.gnome.desktop.background primary-color 'rgb(66, 81, 100)'
    gsettings set org.gnome.shell favorite-apps []
    gsettings set org.gnome.shell.extensions.dash-to-dock dock-position BOTTOM
    gsettings set org.gnome.shell favorite-apps "['firefox_firefox.desktop', 'google-chrome.desktop', 'torbrowser.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop', 'updates.desktop', 'tools.desktop', 'youtube_dl.desktop', 'ffmpeg.desktop', 'streamlink.desktop', 'instagram.desktop', 'gallery.desktop', 'usertool.desktop', 'eyewitness.desktop', 'domains.desktop', 'metadata.desktop', 'httrack.desktop', 'metagoofil.desktop', 'elasticsearch.desktop', 'reddit.desktop', 'internetarchive.desktop', 'spiderfoot.desktop', 'recon-ng.desktop', 'mediainfo-gui.desktop', 'google-earth-pro.desktop', 'kazam.desktop', 'keepassxc_keepassxc.desktop', 'gnome-control-center.desktop']"
    gsettings set org.gnome.shell.extensions.dash-to-dock dash-max-icon-size 32
}

#Installing Software Updates
software_updates() {
    echo "[+] Installing Software Updates..."
    sudo apt update
    sudo apt -y upgrade
    sudo snap refresh
    sudo apt update --fix-missing
    sudo apt --fix-broken install
    sudo -H pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 sudo -H pip install -U
    cd ~/tools/sherlock
    git pull https://github.com/sherlock-project/sherlock.git
    cd ~/tools/WhatsMyName
    git pull https://github.com/WebBreacher/WhatsMyName.git
    cd ~/tools
    wget -N https://github.com/ripmeapp/ripme/releases/latest/download/ripme.jar
    cd ~/tools/EyeWitness
    git pull https://github.com/ChrisTruncer/EyeWitness.git
    cd ~/tools/Sublist3r
    git pull https://github.com/aboul3la/Sublist3r.git
    cd ~/tools/Photon
    git pull https://github.com/s0md3v/Photon.git
    cd ~/tools/theHarvester
    git pull https://github.com/laramies/theHarvester.git
    cd ~/tools/Carbon14
    git pull https://github.com/Lazza/Carbon14
    cd ~/tools/metagoofil
    git pull https://github.com/opsdisk/metagoofil.git
    cd ~/tools/sherloq
    git pull https://github.com/GuidoBartoli/sherloq.git
    cd ~/tools/recon-ng
    git pull https://github.com/lanmaster53/recon-ng.git
    cd ~/tools/spiderfoot
    git pull https://github.com/smicallef/spiderfoot.git
    cd ~/tools/Elasticsearch-Crawler
    git pull https://github.com/AmIJesse/Elasticsearch-Crawler.git
    cd ~/tools/ghunt
    git pull https://github.com/mxrch/ghunt.git
    sudo apt autoremove -y
}

#Optional Caller ID Script
caller_id() {
    echo "[+] Installing Caller ID Scripts..."
    cd ~/tools/scripts
    curl -u osint9:book143wt -O  https://inteltechniques.com/osintbook9/cid.sh
    chmod +x cid.sh
    curl -u osint9:book143wt -O  https://inteltechniques.com/osintbook9/cid.desktop
    chmod +x cid.desktop
    sudo cp cid.desktop /usr/share/applications/
    rm cid.desktop
}

#####-----CALL THE MENU FUNCTION-----#####
main_menu ## Needed to run the menu function